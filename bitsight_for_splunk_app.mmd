%% =========================================================
%% BitSight Security Ratings for Splunk
%% Full Splunk App – End-to-End System Map
%% =========================================================

flowchart LR

%% ========================
%% BitSight Platform
%% ========================
subgraph BS["BitSight Platform"]
  BS_API["BitSight API\n(api.bitsighttech.com)"]
end

%% ========================
%% Splunk App – Setup & Control
%% ========================
subgraph SETUP["Splunk App Setup & Control Plane"]
  SETUP_UI["Splunk Web Setup UI\n(setup.xml)"]
  APP_CONF["App Configuration\n(bitsight.conf)"]
  VALIDATE["Config Validation\n(bitsight_validation.py)"]
  PROXY["Proxy / SSL Settings"]
end

%% ========================
%% Data Collection
%% ========================
subgraph COLLECT["Data Collection (Modular Inputs)"]
  INPUT["Modular Input\n(bitsight_input.py)"]

  PORTFOLIO["Portfolio Companies"]
  RATINGS["Current Ratings"]
  HISTORY["Ratings History"]
  FINDINGS["Findings"]
  FINDINGS_SUM["Findings Summary"]
  ALERTS["Alerts"]
  THREATS["Threat Intelligence"]
  CREDS["Exposed Credentials"]
  USERS["Users & Quota"]
end

%% ========================
%% Splunk Index & Sourcetypes
%% ========================
subgraph INDEX["Splunk Index: security_bitsight"]
  ST_PORT["bitsight:portfolio"]
  ST_RATE["bitsight:current_ratings"]
  ST_HIST["bitsight:ratings_history"]
  ST_FIND["bitsight:findings"]
  ST_FIND_SUM["bitsight:findings_summary"]
  ST_ALERT["bitsight:alerts"]
  ST_THREAT["bitsight:threats"]
  ST_CREDS["bitsight:exposed_credentials"]
  ST_USERS["bitsight:users"]
  ST_QUOTA["bitsight:user_quota"]
end

%% ========================
%% Knowledge Objects
%% ========================
subgraph KNOW["Splunk Knowledge Objects"]
  PROPS["Field Extractions\n(props.conf)"]
  TRANS["Transforms & Lookups"]
  MACROS["Search Macros"]
end

%% ========================
%% Analytics & Automation
%% ========================
subgraph ANALYTICS["Saved Searches & Analytics"]
  SEARCHES["Saved Searches\n(savedsearches.conf)"]
  SLA["SLA / MTTR Metrics"]
  NIST["NIST CSF Mapping"]
  HEALTH["Health & Ops Metrics"]
end

%% ========================
%% Alert Actions
%% ========================
subgraph ALERTING["Alert Actions"]
  EMAIL["Email"]
  WEBHOOK["Webhook"]
  SCRIPT["Script"]
  PD["PagerDuty"]
end

%% ========================
%% Dashboards & Reports
%% ========================
subgraph DASH["Dashboards & Reports (26 XML Views)"]
  EXEC["Executive Overview / Reports"]
  PORT["Portfolio & Benchmarking"]
  RATE["Ratings & Trending"]
  FIND["Findings & Remediation"]
  THREAT["Threats & Credentials"]
  USERD["Users & Access Review"]
  OPS["Health / Operations / Logs"]
end

%% ========================
%% Flows
%% ========================
SETUP_UI --> APP_CONF
APP_CONF --> VALIDATE
PROXY --> INPUT
VALIDATE --> INPUT

INPUT -->|API Calls| BS_API

BS_API --> PORTFOLIO
BS_API --> RATINGS
BS_API --> HISTORY
BS_API --> FINDINGS
BS_API --> FINDINGS_SUM
BS_API --> ALERTS
BS_API --> THREATS
BS_API --> CREDS
BS_API --> USERS

PORTFOLIO --> ST_PORT
RATINGS --> ST_RATE
HISTORY --> ST_HIST
FINDINGS --> ST_FIND
FINDINGS_SUM --> ST_FIND_SUM
ALERTS --> ST_ALERT
THREATS --> ST_THREAT
CREDS --> ST_CREDS
USERS --> ST_USERS
USERS --> ST_QUOTA

ST_PORT --> PROPS
ST_RATE --> PROPS
ST_HIST --> PROPS
ST_FIND --> PROPS
ST_FIND_SUM --> PROPS
ST_ALERT --> PROPS
ST_THREAT --> PROPS
ST_CREDS --> PROPS
ST_USERS --> PROPS
ST_QUOTA --> PROPS

PROPS --> TRANS
TRANS --> MACROS
MACROS --> SEARCHES

SEARCHES --> SLA
SEARCHES --> NIST
SEARCHES --> HEALTH

SEARCHES --> EMAIL
SEARCHES --> WEBHOOK
SEARCHES --> SCRIPT
SEARCHES --> PD

SEARCHES --> EXEC
SEARCHES --> PORT
SEARCHES --> RATE
SEARCHES --> FIND
SEARCHES --> THREAT
SEARCHES --> USERD
SEARCHES --> OPS
