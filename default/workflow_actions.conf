#
# Bitsight Workflow Actions Configuration
# Right-click context actions for Bitsight data in Splunk
#

# ============================================================================
# COMPANY ACTIONS
# ============================================================================

[bitsight_view_company_portal]
display_location = both
fields = company_guid
label = View in Bitsight Portal
link.method = get
link.target = blank
link.uri = https://service.bitsighttech.com/app/spm/company/$company_guid$/overview
type = link

[bitsight_view_company_findings]
display_location = both
fields = company_guid
label = View Company Findings in Bitsight
link.method = get
link.target = blank
link.uri = https://service.bitsighttech.com/app/spm/company/$company_guid$/findings
type = link

[bitsight_view_company_infrastructure]
display_location = both
fields = company_guid
label = View Company Infrastructure
link.method = get
link.target = blank
link.uri = https://service.bitsighttech.com/app/spm/company/$company_guid$/infrastructure
type = link

[bitsight_search_company_all]
display_location = both
fields = company_guid
label = Search All Bitsight Data for Company
search.search_string = index=security_bitsight company_guid="$company_guid$" | stats count by sourcetype
type = search

[bitsight_search_company_findings]
display_location = both
fields = company_guid
label = Search Findings for Company
search.search_string = index=security_bitsight sourcetype=bitsight:findings company_guid="$company_guid$" | table _time risk_vector severity asset details
type = search

[bitsight_search_company_ratings_history]
display_location = both
fields = company_guid, company_name
label = View Rating History for Company
search.search_string = index=security_bitsight sourcetype=bitsight:ratings:history company_guid="$company_guid$" | timechart span=1d avg(rating) as rating by company_name
type = search

[bitsight_search_company_credentials]
display_location = both
fields = company_guid
label = Search Exposed Credentials for Company
search.search_string = index=security_bitsight sourcetype=bitsight:credentials company_guid="$company_guid$" | table _time email breach_name breach_date
type = search

# ============================================================================
# COMPANY NAME ACTIONS
# ============================================================================

[bitsight_search_by_company_name]
display_location = both
fields = company_name
label = Search All Data for "$company_name$"
search.search_string = index=security_bitsight company_name="$company_name$" | stats count by sourcetype
type = search

[bitsight_company_risk_summary]
display_location = both
fields = company_name
label = Risk Summary for "$company_name$"
search.search_string = index=security_bitsight sourcetype=bitsight:findings company_name="$company_name$" | stats count as finding_count by severity | sort -finding_count
type = search

# ============================================================================
# RISK VECTOR ACTIONS
# ============================================================================

[bitsight_search_risk_vector]
display_location = both
fields = risk_vector
label = Search All Findings for Risk Vector
search.search_string = index=security_bitsight sourcetype=bitsight:findings risk_vector="$risk_vector$" | stats count by company_name severity | sort -count
type = search

[bitsight_risk_vector_details]
display_location = both
fields = risk_vector
label = View Risk Vector Details
link.method = get
link.target = blank
link.uri = https://help.bitsighttech.com/hc/en-us/search?utf8=%E2%9C%93&query=$risk_vector$
type = link

[bitsight_risk_vector_by_company]
display_location = both
fields = risk_vector
label = Companies Affected by "$risk_vector$"
search.search_string = index=security_bitsight sourcetype=bitsight:findings risk_vector="$risk_vector$" | stats dc(asset) as affected_assets count as findings by company_name | sort -findings
type = search

# ============================================================================
# ASSET/IP ACTIONS
# ============================================================================

[bitsight_search_asset_findings]
display_location = both
fields = asset
label = Search Findings for Asset
search.search_string = index=security_bitsight sourcetype=bitsight:findings asset="$asset$" | table _time company_name risk_vector severity details
type = search

[bitsight_lookup_ip_shodan]
display_location = both
fields = asset
label = Lookup IP in Shodan
link.method = get
link.target = blank
link.uri = https://www.shodan.io/host/$asset$
type = link

[bitsight_lookup_ip_virustotal]
display_location = both
fields = asset
label = Lookup in VirusTotal
link.method = get
link.target = blank
link.uri = https://www.virustotal.com/gui/search/$asset$
type = link

[bitsight_lookup_ip_censys]
display_location = both
fields = asset
label = Lookup IP in Censys
link.method = get
link.target = blank
link.uri = https://search.censys.io/hosts/$asset$
type = link

[bitsight_lookup_domain_whois]
display_location = both
fields = asset
label = WHOIS Lookup
link.method = get
link.target = blank
link.uri = https://www.whois.com/whois/$asset$
type = link

[bitsight_lookup_dns]
display_location = both
fields = asset
label = DNS Lookup
link.method = get
link.target = blank
link.uri = https://dnschecker.org/all-dns-records-of-domain.php?query=$asset$
type = link

# ============================================================================
# EMAIL/CREDENTIAL ACTIONS
# ============================================================================

[bitsight_search_email_breaches]
display_location = both
fields = email
label = Search Breaches for Email
search.search_string = index=security_bitsight sourcetype=bitsight:credentials email="$email$" | table _time breach_name breach_date password_type
type = search

[bitsight_lookup_email_hibp]
display_location = both
fields = email
label = Check Email in Have I Been Pwned
link.method = get
link.target = blank
link.uri = https://haveibeenpwned.com/account/$email$
type = link

[bitsight_search_domain_credentials]
display_location = field
fields = email
label = Search All Credentials for Domain
search.search_string = index=security_bitsight sourcetype=bitsight:credentials | rex field=email "@(?<email_domain>.+)$" | search email_domain="*" | stats count by email breach_name | sort -count
type = search

# ============================================================================
# SEVERITY ACTIONS
# ============================================================================

[bitsight_search_severity_findings]
display_location = both
fields = severity
label = Search All "$severity$" Findings
search.search_string = index=security_bitsight sourcetype=bitsight:findings severity="$severity$" | stats count by company_name risk_vector | sort -count
type = search

[bitsight_critical_findings_report]
display_location = both
fields = severity
label = Critical Findings Report
search.search_string = index=security_bitsight sourcetype=bitsight:findings severity IN ("critical", "severe", "high") | stats count as findings dc(asset) as assets by company_name risk_vector | sort -findings
type = search

# ============================================================================
# RATING ACTIONS
# ============================================================================

[bitsight_search_low_ratings]
display_location = both
fields = rating
label = Search Companies with Similar Rating
search.search_string = index=security_bitsight sourcetype=bitsight:portfolio | eval rating_range=floor(rating/50)*50 | where rating_range=floor($rating$/50)*50 | stats latest(rating) as rating by company_name | sort rating
type = search

[bitsight_rating_trend_analysis]
display_location = both
fields = rating, company_guid
label = Rating Trend Analysis
search.search_string = index=security_bitsight sourcetype=bitsight:ratings:history company_guid="$company_guid$" | timechart span=1w avg(rating) as rating | trendline sma5(rating) as trend
type = search

# ============================================================================
# PROVIDER/PRODUCT ACTIONS (4th Party)
# ============================================================================

[bitsight_search_provider_dependencies]
display_location = both
fields = provider_name
label = Search Companies Using Provider
search.search_string = index=security_bitsight sourcetype=bitsight:providers provider_name="$provider_name$" | stats count by company_name | sort -count
type = search

[bitsight_search_product_usage]
display_location = both
fields = product_name
label = Search Product Usage Across Portfolio
search.search_string = index=security_bitsight sourcetype=bitsight:products product_name="$product_name$" | stats count by company_name domain | sort -count
type = search

# ============================================================================
# ALERT ACTIONS
# ============================================================================

[bitsight_search_alert_history]
display_location = both
fields = alert_type
label = Search Alert History
search.search_string = index=security_bitsight sourcetype=bitsight:alerts alert_type="$alert_type$" | table _time company_name alert_type details
type = search

[bitsight_company_alert_summary]
display_location = both
fields = company_guid
label = Alert Summary for Company
search.search_string = index=security_bitsight sourcetype=bitsight:alerts company_guid="$company_guid$" | stats count by alert_type | sort -count
type = search

# ============================================================================
# THREAT ACTIONS
# ============================================================================

[bitsight_search_threat_indicator]
display_location = both
fields = indicator
label = Search Threat Indicator
search.search_string = index=security_bitsight sourcetype=bitsight:threats indicator="$indicator$" | table _time company_name threat_type indicator details
type = search

[bitsight_lookup_threat_otx]
display_location = both
fields = indicator
label = Lookup in AlienVault OTX
link.method = get
link.target = blank
link.uri = https://otx.alienvault.com/indicator/ip/$indicator$
type = link

# ============================================================================
# INDUSTRY ACTIONS
# ============================================================================

[bitsight_search_industry_companies]
display_location = both
fields = industry
label = Search Companies in Industry
search.search_string = index=security_bitsight sourcetype=bitsight:portfolio industry="$industry$" | stats latest(rating) as rating by company_name | sort -rating
type = search

[bitsight_industry_benchmark]
display_location = both
fields = industry
label = Industry Benchmark Analysis
search.search_string = index=security_bitsight sourcetype=bitsight:portfolio industry="$industry$" | stats avg(rating) as avg_rating min(rating) as min_rating max(rating) as max_rating median(rating) as median_rating count as companies
type = search

# ============================================================================
# TIER ACTIONS
# ============================================================================

[bitsight_search_tier_companies]
display_location = both
fields = tier
label = Search Companies in Tier
search.search_string = index=security_bitsight sourcetype=bitsight:portfolio tier="$tier$" | stats latest(rating) as rating by company_name | sort -rating
type = search

# ============================================================================
# GENERAL UTILITY ACTIONS
# ============================================================================

[bitsight_google_search]
display_location = both
fields = *
label = Google Search
link.method = get
link.target = blank
link.uri = https://www.google.com/search?q=$@field_value$
type = link

[bitsight_copy_to_clipboard]
display_location = field
fields = *
label = Copy Value
link.method = get
link.target = blank
link.uri = javascript:navigator.clipboard.writeText('$@field_value$')
type = link
