#
# Bitsight Alert Actions Configuration
# Configure automated notifications when alerts trigger
#

# ============================================================================
# EMAIL ALERT ACTION
# ============================================================================
[bitsight_email_alert]
is_custom = 1
label = Bitsight Email Alert
description = Send email notification for Bitsight security rating changes
icon_path = appIcon.png
payload_format = json
disabled = 0

param.to = 
param.cc = 
param.subject = [Bitsight Alert] $name$
param.message = Bitsight Security Alert\n\nAlert: $name$\nTime: $trigger_time$\nResults: $result.count$ events matched\n\nDetails:\n$result._raw$
param.include_results = 1
param.include_link = 1
param.priority = normal

# ============================================================================
# WEBHOOK ALERT ACTION
# ============================================================================
[bitsight_webhook_alert]
is_custom = 1
label = Bitsight Webhook Alert
description = Send webhook notification to external systems (Slack, Teams, PagerDuty, etc.)
icon_path = appIcon.png
payload_format = json
disabled = 0

param.webhook_url = 
param.method = POST
param.content_type = application/json
param.include_results = 1
param.custom_headers = 
param.verify_ssl = 1
param.timeout = 30

# Payload template (JSON)
param.payload_template = {"alert_name": "$name$", "trigger_time": "$trigger_time$", "results_count": "$result.count$", "search_name": "$search_name$", "app": "$app$", "owner": "$owner$", "results_link": "$results_link$", "severity": "$result.severity$", "company": "$result.company_name$", "rating": "$result.rating$", "rating_change": "$result.rating_change$"}

# ============================================================================
# SCRIPT ALERT ACTION
# ============================================================================
[bitsight_script_alert]
is_custom = 1
label = Bitsight Script Alert
description = Execute custom script for Bitsight alerts (ticket creation, SOAR integration, etc.)
icon_path = appIcon.png
payload_format = json
disabled = 0

param.script_name = bitsight_alert_script.py
param.script_args = 
param.pass_payload = 1

# ============================================================================
# SERVICENOW INTEGRATION
# ============================================================================
[bitsight_snow_alert]
is_custom = 1
label = Bitsight ServiceNow Alert
description = Create ServiceNow incidents for critical Bitsight findings
icon_path = appIcon.png
payload_format = json
disabled = 0

param.snow_url = 
param.snow_user = 
param.snow_password = 
param.incident_category = Security
param.incident_subcategory = Vendor Risk
param.incident_priority = 3
param.incident_short_description = [Bitsight] $result.company_name$ - Rating Alert
param.incident_description = Security rating alert triggered for $result.company_name$.\n\nCurrent Rating: $result.rating$\nChange: $result.rating_change$\nRisk Vectors Affected: $result.risk_vectors$\n\nAlert Details:\nName: $name$\nTime: $trigger_time$

# ============================================================================
# PAGERDUTY INTEGRATION
# ============================================================================
[bitsight_pagerduty_alert]
is_custom = 1
label = Bitsight PagerDuty Alert
description = Trigger PagerDuty incidents for critical Bitsight alerts
icon_path = appIcon.png
payload_format = json
disabled = 0

param.routing_key = 
param.severity = error
param.dedup_key = bitsight-$result.company_guid$-$result.risk_vector$
param.event_action = trigger
param.summary = Bitsight Alert: $result.company_name$ - $name$
param.source = Splunk Bitsight App
param.component = $result.risk_vector$
param.group = vendor-risk
param.class = security-rating
